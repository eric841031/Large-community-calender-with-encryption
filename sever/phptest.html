<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>phptest</title>
<style type="text/css">
table{border-collapse:collapse;width:100%}
th,td{border:1px solid;text-align: center;padding:0px;width:12.5%}
input.itxt{border:none;width:98%;margin:0px;display:inline-block;}
div.dtxt{width:98%;margin:0px;padding:1%;display: inline-block;}
</style>
</head>
<script type="text/javascript" >
function B64AtoV(bs,pos,N)
{
	var k=0;
	for(var i=0,a;i<N && pos+i<bs.length;++i)
	{
		if(!bs[pos+i])
			alert(""+(pos+i));
		a=bs[pos+i].charCodeAt();
		if(0x41<=a && a<=0x5A)
			k=k<<6|a-0x41;
		else if(0x61<=a && a<=0x7A)
			k=k<<6|a-0x61+26;
		else if(0x30<=a && a<=0x39)
			k=k<<6|a-0x30+52;
		else if(a==0x2B)
			k=k<<6|62;
		else if(a==0x2F)
			k=k<<6|63;
	}
	return k;
}
function VtoB64A(k,N)
{
	var A="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";
	var i;
	var r="";
	for(i=0;i<N;++i)
	{
		r=A[k&0x3F]+r;
		k=k>>>6;
	}
	return r;
}
function cll_php(url,params,cbk_func,ststus_div)
{
	var http = new XMLHttpRequest();
	http.open("POST", url, true);
	http.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
	http.setRequestHeader("Content-length", params.length);
	http.setRequestHeader("Connection", "close");
	http.onreadystatechange = function() 
	{
		if(http.readyState == 4)
		{
			if(http.status == 200)
			{
				eval(cbk_func);
				ststus_div.innerHTML="　";
			}
			else if(ststus_div)
				ststus_div.innerHTML="連線失敗，請重試！";
		}
	}
	if(ststus_div)
		ststus_div.innerHTML="讀取中，請稍候...";
	http.send(params);
}
</script>
<script type="text/javascript" >
var inp,ret,log,row;
function init()
{
	row=document .getElementById("input");
	ret=document .getElementById("return");
	log=document .getElementById("log");
}
function getParaStr()
{
	if(inp[0]=="")
		return ;
	var str="cmd="+inp[0];
	var tmp;
	if(inp[1]!="")
		str+="&key="+inp[1];
	if(inp[2]!="")
		str+="&did="+VtoB64A(parseInt(inp[2]),5);
	if(inp[3]!="")
	{
		tmp=inp[3].split("/");
		str+="&date="+VtoB64A((parseInt(tmp[0])*12+parseInt(tmp[1]))*31+parseInt(tmp[2]),4);
	}
	if(inp[4]!="")
	{
		tmp=inp[4].split("/");
		str+="&dateE="+VtoB64A((parseInt(tmp[0])*12+parseInt(tmp[1]))*31+parseInt(tmp[2]),4);
	}
	if(inp[5]!="")
	{
		tmp=inp[5].split("/");
		str+="&uid="+VtoB64A(parseInt(tmp[0])<<9|parseInt(tmp[1]),2);
	}
	if(inp[6]!="")
	{
		tmp=inp[6].split("/");
		str+="&gid="+VtoB64A(parseInt(tmp[0])<<9|parseInt(tmp[1]),2);
	}
	if(inp[7]!="")
		str+="&val="+inp[7];
	return str;
}
function show()
{
	var t;
	inp=[];
	for(var i=0;i<row.cells.length;++i)
		inp[i]=row.cells[i].children[0].children[0].value;
	t=getParaStr().replace(/[&]?[a-zA-Z]*=/g,"\t").trim().split("\t");
	var d1=B64AtoV(t[3],0,4);
	var d2=B64AtoV(t[4],0,4);
	var i1=B64AtoV(t[5],0,2);
	var i2=B64AtoV(t[6],0,2);
	d1=""+(d1/31/12|0)+"/"+(d1/31|0)%12+"/"+(d1|0)%31;
	d2=""+(d2/31/12|0)+"/"+(d2/31|0)%12+"/"+(d2|0)%31;
	i1=""+(1<<11&i1?"r":"-")+(1<<10&i1?"w":"-")+(1<<9&i1?"x":"-")+(i1&0x1FF);
	i2=""+(1<<11&i2?"r":"-")+(1<<10&i2?"w":"-")+(1<<9&i2?"x":"-")+(i2&0x1FF);
	log.innerHTML="<hr>send:"+getParaStr()+"<hr>";
	cll_php("http://re.3eeweb.com/Demo/sever.php",getParaStr()
		,"phpcbk(http.responseText)",document .getElementById("st"));
}
function phpcbk(str)
{
	var did,dat,uid,gid,r="";
	log.innerHTML+=str.replace(/\n/g,"<br>");
	str=str.trim().split("\n");
	for(var i=0;i<str.length;++i)
	{
		did=B64AtoV(str[i],0,5);
		dat=B64AtoV(str[i],5,4);dat="["+(dat/31/12|0)+"/"+(dat/31|0)%12+"/"+(dat|0)%31+"]";
		uid=B64AtoV(str[i],9,2);uid="&lt;"+(1<<11&uid?"r":"-")+(1<<10&uid?"w":"-")+(1<<9&uid?"x":"-")+"|"+(uid&0x1FF)+"&gt;";
		gid=B64AtoV(str[i],11,2);gid="&lt;"+(1<<11&gid?"r":"-")+(1<<10&gid?"w":"-")+(1<<9&gid?"x":"-")+"|"+(gid&0x1FF)+"&gt;";
		r+="#".concat(did,dat,uid,gid,str[i].substr(13),"<br>");
	}
	ret.innerHTML=r;
}
</script>
<body onload="init()">
<table>
<tr><th>cmd</th><th>key</th><th>did</th><th>date</th><th>dateE</th><th>uid</th><th>gid</th><th>val</th></tr>
<tr id="input">
<td><div class="dtxt"><input type="text" class="itxt"></div></td>
<td><div class="dtxt"><input type="text" class="itxt"></div></td>
<td><div class="dtxt"><input type="text" class="itxt"></div></td>
<td><div class="dtxt"><input type="text" class="itxt"></div></td>
<td><div class="dtxt"><input type="text" class="itxt"></div></td>
<td><div class="dtxt"><input type="text" class="itxt"></div></td>
<td><div class="dtxt"><input type="text" class="itxt"></div></td>
<td><div class="dtxt"><input type="text" class="itxt"></div></td>
</tr>
</table>
<button onclick="show()">show</button>
<div id="return"></div>
<div id="log"></div>
<div id="st"></div>
</body>
</html>